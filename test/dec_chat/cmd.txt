docker run -d --name im -p 3100:3000 oydeu/dc-intermediary:arm64v8

# preparations ---
Doorkeeper::Application.create!({name: 'master', redirect_uri: 'urn:ietf:wg:oauth:2.0:oob', scopes: 'admin write read', organization_id: 1})

export KEY="qiS4Vy4OA_xSWA6JK6Fpbo833TSquTorsiv08Fiv7YE"
export SECRET="MQ_MFFX6VeA_Rw07P3pmtraADWWofsuIn4pcevD-acY"
export TOKEN=`curl -s -d grant_type=client_credentials -d client_id=$KEY -d client_secret=$SECRET -d scope=write -X POST http://localhost:3100/oauth/token | jq -r '.access_token'`

echo '{
  "name": "DEC112 Chat Repository",
  "meta": {"VerifiblePresentation-D2A": "https://chats.go-data.at/presentations/zQmVhfhW6mAs1dh3mhA2xSqdficgjni66Ke2XJNB4R4uVm9"}}' | \
curl -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" -d @- \
     -X POST http://localhost:3100/collection/

# create access ---
echo '{"VerifiablePresentation-D3A": "https://chats.go-data.at/presentations/zQmVGSoLocMwJ1fE6hS3QkrVHZgQC4uuVMnvXwY4raG75Dr"}' |
curl -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" -d @- \
     -X POST http://localhost:3100/collection/1/access


# validate manually ---

cat d2a.json | jq '.purposes[0].processing_method' | jq -r 'split(", ") | map("scdv:\( .[:1] | ascii_upcase)\(.[1:] )") | join(", ")' | {methods: .}'

jq -s '{"data-subject": .[0], "data-controller": .[1]}' \
   UP-DataSource.jsonld  UP-DataUser.jsonld |
curl -s -o /dev/null -w "%{http_code}" -H "Content-Type: application/json" -d @- \
-X POST https://scdv-matching-oc3.data-container.net/api/validate/usagepolicy